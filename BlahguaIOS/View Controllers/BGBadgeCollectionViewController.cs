// This file has been autogenerated from a class added in the UI designer.

using System;

using BlahguaMobile.BlahguaCore;

using MonoTouch.Foundation;
using MonoTouch.UIKit;

namespace BlahguaMobile.IOS
{
	public partial class BGBadgeCollectionViewController : UICollectionViewController
	{


		public BGBadgeCollectionViewController (IntPtr handle) : base (handle)
		{
		}

		public override void ViewDidLoad ()
		{
            AppDelegate.analytics.PostPageView("/self/badges");

			base.ViewDidLoad ();

			this.NavigationController.SetNavigationBarHidden(false, true);

			View.BackgroundColor = UIColor.White;

			NavigationItem.RightBarButtonItem = new UIBarButtonItem ("Add", UIBarButtonItemStyle.Plain, NewBadge);
			CollectionView.BackgroundColor = UIColor.White;

			CollectionView.DataSource = new BGBadgeCollectionSource ();
		}

		public override void ViewWillAppear (bool animated)
		{
			base.ViewWillAppear (animated);
			CollectionView.ReloadData ();
		}

		private void NewBadge(object sender, EventArgs e)
		{
			PerformSegue ("fromBadgeToNewBadge", this);
		}

		public void RemoveNewBadgeView ()
		{
			throw new NotImplementedException ();
		}
	}

	public class BGBadgeCollectionSource : UICollectionViewDataSource
	{
		public override UICollectionViewCell GetCell (UICollectionView collectionView, NSIndexPath indexPath)
		{
			var cell = (BGBadgeCell)collectionView.DequeueReusableCell (new NSString("badgeCell"), indexPath);
			var badge = BlahguaAPIObject.Current.CurrentUser.Badges[indexPath.Row];
			cell.SetUp (badge.BadgeImage, badge.BadgeName);
			return cell;
		}

		public override int GetItemsCount (UICollectionView collectionView, int section)
		{

			return BlahguaAPIObject.Current.CurrentUser.Badges == null ? 0 : BlahguaAPIObject.Current.CurrentUser.Badges.Count;
		}

		public override int NumberOfSections (UICollectionView collectionView)
		{
			return 1;
		}
	}
}
