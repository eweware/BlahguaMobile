// This file has been autogenerated from a class added in the UI designer.

using System;
using System.Drawing;

using BlahguaMobile.BlahguaCore;

using MonoTouch.Foundation;
using MonoTouch.UIKit;
using MonoTouch.Dialog.Utilities;

namespace BlahguaMobile.IOS
{
	public partial class BGCommentTableCell : UITableViewCell
	{
		private const float baseXStart = 20f;
		private const float space = 8f;

		private SizeF baseSizeForFitting = new SizeF (240, 21);

		private float yCoordStart;
		private float labelXCoordStart;

		public UIImageView commentImageView;

		public BGCommentTableCell (IntPtr handle) : base (handle)
		{
		}

		public void SetUp(Comment comment)
		{

			yCoordStart = space;
			labelXCoordStart = baseXStart;
			if(!String.IsNullOrEmpty(comment.ImageURL))
			{
				commentImageView = new UIImageView ();
				commentImageView.Image = ImageLoader.DefaultRequestImage(new Uri(comment.ImageURL), new ImageUpdateDelegate (commentImageView));
				ContentView.AddSubview (commentImageView);
				commentImageView.Frame = new RectangleF (0, yCoordStart, 320f, 161f);
				yCoordStart += commentImageView.Frame.Height + space;
			}

			//text.RemoveFromSuperview ();
			if(!String.IsNullOrEmpty(comment.T))
			{
				text.AttributedText = new NSAttributedString (comment.T, UIFont.FromName (BGAppearanceConstants.FontName, 14), UIColor.Black);

				var newSize = text.SizeThatFits (new SizeF (320 - baseXStart * 2, 568));
				ContentView.AddSubview (text);
				text.Frame = new RectangleF (baseXStart, yCoordStart, 320 - baseXStart * 2, newSize.Height);
				yCoordStart += text.Frame.Height + space;
			}

//			author.Frame = new RectangleF (baseXStart, yCoordStart, 100, 21);
			author.AttributedText = new NSAttributedString (
				comment.AuthorName, 
				UIFont.FromName (BGAppearanceConstants.BoldFontName, 14), 
				UIColor.Black
			);
			SetLabelSize (author);


//			timespan.Frame = new RectangleF (author.Frame.Right + space, yCoordStart, 100, 21);
			timespan.AttributedText = new NSAttributedString (
				comment.ElapsedTimeString, 
				UIFont.FromName (BGAppearanceConstants.BoldFontName, 14), 
				UIColor.Black
			);
			SetLabelSize (timespan);


			upAndDownVotes.AttributedText = new NSAttributedString (
				comment.UpVoteCount.ToString() + "/" + comment.DownVoteCount.ToString(), 
				UIFont.FromName (BGAppearanceConstants.BoldFontName, 14), 
				UIColor.Black
			);
			SetLabelSize (upAndDownVotes);
				

//			upAndDownVotes.Frame = new RectangleF (320 - upAndDownVotes.Frame.Width, yCoordStart, upAndDownVotes.Frame.Width, 21);
			ContentView.Frame = new RectangleF (0, 0, 320, yCoordStart + upAndDownVotes.Frame.Height + space);
		}

		private void SetLabelSize(UILabel label)
		{
			label.RemoveFromSuperview ();
			var newSize = label.SizeThatFits(baseSizeForFitting);

			label.Frame = new RectangleF (labelXCoordStart, yCoordStart,newSize.Width, newSize.Height);
			ContentView.AddSubview (label);
			labelXCoordStart += newSize.Width + space;
		}
	}
}
