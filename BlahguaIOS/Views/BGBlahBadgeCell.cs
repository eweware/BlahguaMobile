// This file has been autogenerated from a class added in the UI designer.

using System;

using MonoTouch.Foundation;
using MonoTouch.UIKit;
using MonoTouch.Dialog.Utilities;
using BlahguaMobile.BlahguaCore;

namespace BlahguaMobile.IOS
{
	public partial class BGBlahBadgeCell : UITableViewCell
	{
		public BGBlahBadgeCell (IntPtr handle) : base (handle)
		{
		}

        public void SetUp(BadgeReference theBadge)
        {
            SetUp(theBadge.BadgeName, theBadge.BadgeImage);
            if (String.IsNullOrEmpty(theBadge.BadgeName))
            {
                BlahguaAPIObject.Current.GetBadgeInfo(theBadge.ID, (badgeResult) =>
                    {
                        if (badgeResult != null)
                        {
                            theBadge.BadgeName = badgeResult.N;
                            theBadge.CreationDate = badgeResult.CreationDate;
                            theBadge.ExpirationDate = badgeResult.ExpirationDate;
                            theBadge.AuthorityDisplayName = badgeResult.D;
                            theBadge.AuthorityEndpoint = badgeResult.A;
                            DecorateBadge(theBadge.BadgeName);
                        }


                    }
                );
            }
        }

        private void DecorateBadge (string badgeName)
        {
            this.badgeName.AttributedText = new NSAttributedString (
                badgeName, 
                UIFont.FromName (BGAppearanceConstants.BoldFontName, 10), 
                UIColor.Black
            );
        }

		public void SetUp(string badgeName, string badgeImageUrl)
		{
			verifiedLabel.AttributedText = new NSAttributedString (
				"verified", 
				UIFont.FromName (BGAppearanceConstants.MediumFontName, 10), 
				UIColor.Black
			);
			Uri uri = null;
			if (Uri.TryCreate (badgeImageUrl, UriKind.RelativeOrAbsolute, out uri))
				badgeImage.Image = ImageLoader.DefaultRequestImage (uri, new ImageUpdateDelegate (badgeImage));
			else
                badgeImage.Image = UIImage.FromBundle ("badges");

            DecorateBadge(badgeName);
		}
	}
}
